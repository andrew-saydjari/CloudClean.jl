<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · CloudClean.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>CloudClean.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#Covariance-Construction-Functions"><span>Covariance Construction Functions</span></a></li><li><a class="tocitem" href="#Per-Location-Functions"><span>Per Location Functions</span></a></li><li><a class="tocitem" href="#Image-Preprocessing"><span>Image Preprocessing</span></a></li><li><a class="tocitem" href="#DECam-Specific-Functions"><span>DECam Specific Functions</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/main/docs/src/api.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><h2 id="Covariance-Construction-Functions"><a class="docs-heading-anchor" href="#Covariance-Construction-Functions">Covariance Construction Functions</a><a id="Covariance-Construction-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Covariance-Construction-Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="CloudClean.cov_avg!" href="#CloudClean.cov_avg!"><code>CloudClean.cov_avg!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">cov_avg!(bimage, ism, bism, in_image; Np::Int=33, widx::Int=129, widy::Int=129, ftype::Int=32)

Key function for constructing the (shifted and multiplied) versions of the input image used to quickly
estimate the local covariance matrix at a large number of locations. The main output is in the preallocated
`bism` which is used as an input to `build_cov!`.

# Arguments:
- `bimage`: preallocated output array for the boxcar smoothed unshifted image
- `ism`: preallocated intermediate array for the input image times itself shifted
- `bism`: preallocated output array to store boxcar-smoothed image products for all shifts
- `in_image`: input image the local covariance of which we want to estimate

# Keywords:
- `Np::Int`: size of local covariance matrix in pixels (default 33)
- `widx::Int`: width of boxcar window in x which determines size of region used for samples for the local covariance estimate (default 129)
- `widy::Int`: width of boxcar window in y which determines size of region used for samples for the local covariance estimate (default 129)
- `ftype::Int`: determine the Float precision, 32 is Float32, otherwise Float64</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/cov.jl#L79-L97">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CloudClean.boxsmooth!" href="#CloudClean.boxsmooth!"><code>CloudClean.boxsmooth!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">boxsmooth!(out::AbstractArray, arr::AbstractArray, tot::Array{T,1}, widx::Int, widy::Int)

Boxcar smooths an input image (or paddedview) `arr` with window size `widx` by
`widy`. We pass the original image size `sx` and `sy` to help handle image views.

# Arguments:
- `out::AbstractArray`: preallocated output array for the boxcar smoothed image
- `arr::AbstractArray`: input array for which boxcar smoothing is computed (generally paddedview)
- `tot::Array{T,1}`: preallocated array to hold moving sums along 1 dimension
- `widx::Int`: size of boxcar smoothing window in x
- `widy::Int`: size of boxcar smoothing window in y</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/cov.jl#L36-L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CloudClean.outest_bounds" href="#CloudClean.outest_bounds"><code>CloudClean.outest_bounds</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">outest_bounds(cx,sx) -&gt; px0

Helper function to find maximum padding in pixels required to accomodate all query points `cx` outside of the image size 1:`sx`.

# Arguments:
- `cx`: list of integer star centers (in either x or y)
- `sx`: image dimension along the axis indexed by `cx`

# Outputs:
- `px0`: maximum padding in pixels required to accomodate all query points</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/cov.jl#L10-L21">source</a></section></article><h2 id="Per-Location-Functions"><a class="docs-heading-anchor" href="#Per-Location-Functions">Per Location Functions</a><a id="Per-Location-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Per-Location-Functions" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>gen_pix_mask_trivial</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>gen_pix_mask_circ</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="CloudClean.condCovEst_wdiag" href="#CloudClean.condCovEst_wdiag"><code>CloudClean.condCovEst_wdiag</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">condCovEst_wdiag(cov_loc,μ,km,data_in;Np=33,export_mean=false,n_draw=0) -&gt; out

Using a local covariance matrix estimate `cov_loc` and a set of known (&quot;good&quot;) pixels `km`, this function computes a prediction for the mean value of masked pixels and the covariance matrix of the masked pixels. The output list can conditionally include the mean reconstruction and draws from the distribution of reconstructions.

# Arguments:
- `cov_loc`: local covariance matrix
- `μ`: vector containing mean value for each pixel in the patch
- `km`: unmasked pixels
- `data_in`: input image

# Keywords:
- `Np`: size of local covariance matrix in pixels (default 33)
- `export_mean`: when true, returns the mean conditional prediction for the &quot;hidden&quot; pixels (default false)
- `n_draw`: when nonzero, returns that number of realizations of the conditional infilling (default 0)

# Outputs:
- `out[1]`: input image returned with masked pixels replaced with mean prediction
- `out[2]`: input image returned with masked pixels replaced with a draw from the predicted distribution</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/per_loc.jl#L22-L41">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CloudClean.build_cov!" href="#CloudClean.build_cov!"><code>CloudClean.build_cov!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">build_cov!(cov::Array{T,2},μ::Array{T,1},cx::Int,cy::Int,bimage::Array{T,2},bism::Array{T,4},Np::Int,widx::Int,widy::Int) where T &lt;:Union{Float32,Float64}

Constructs the local covariance matrix and mean for an image patch of size `Np` x `Np` pixels around a location
of interest (`cx`,`cy`). The construction is just a lookup of pixel values from the stored boxcar-smoothed copies
of the input image times itself shifted in `bism`. Passing the smoothed image `bimage` and the widths of the boxcar
mean `widx` and `widy` is helpful for the mean and normalization. The covariance and mean are updated in place
for speed since this operation may be performed billions of times since we construct a new covariance matrix for
every detection. Math may either be performed `Float32` or `Float64`.

# Arguments:
- `cov::Array{T,2}`: preallocated output array for local covariance matrix
- `μ::Array{T,1}`: preallocated output vector for local mean
- `cx::Int`: x-coordinate of the center of the local region
- `cy::Int`: y-coordinate of the center of the local region
- `bimage::Array{T,2}`: boxcar smoothed unshifted image
- `bism::Array{T,4}`: boxcar-smoothed image products for all shifts
- `Np::Int`: size of local covariance matrix in pixels
- `widx::Int`: width of boxcar window in x which determines size of region used for samples for the local covariance estimate
- `widy::Int`: width of boxcar window in y which determines size of region used for samples for the local covariance estimate</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/per_loc.jl#L77-L97">source</a></section></article><h2 id="Image-Preprocessing"><a class="docs-heading-anchor" href="#Image-Preprocessing">Image Preprocessing</a><a id="Image-Preprocessing-1"></a><a class="docs-heading-anchor-permalink" href="#Image-Preprocessing" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="CloudClean.prelim_infill!" href="#CloudClean.prelim_infill!"><code>CloudClean.prelim_infill!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">prelim_infill!(testim,bmaskim,bimage,bimageI,testim2,bmaskim2,goodpix;widx=19,widy=19,ftype::Int=32,widmult=1.4)

This intial infill replaces masked pixels with a guess based on a smoothed
boxcar. For large masked regions, the smoothing scale is increased. If this
iteration takes too long/requires too strong of masking, the masked pixels
are replaced with the median of the image.

We use 3 copies of the input image and mask image. The first
is a view (with reflective boundary condition padding) with the pixels to be infilled
replaced with zeros, the second is allocated to hold various smoothings of the image,
and the third holds the output image which contains our best infill guess. A final Bool
array of size corresponding to the image is used to keep track of pixels that have safe
infill values.

# Arguments:
- `testim`: input image which requires infilling
- `bmaskim`: input mask indicating which pixels require infilling
- `bimage`: preallocated array for smoothed version of input image
- `bimageI`: preallocated array for smoothed mask counting the samples for each estimate
- `testim2`: inplace modified ouptut array for infilled version of image input
- `bmaskim2`: inplace modified mask to keep track of which pixels still need infilling
- `goodpix`: preallocated array for Bool indexing pixels with good infill

# Keywords:
- `widx`: initial size of boxcar smoothing window in x (default 19)
- `widy`: initial size of boxcar smoothing window in y (default 19)
- `ftype::Int`: determine the Float precision, 32 is Float32, otherwise Float64
- `widmult`: multiplicative factor for increasing the smoothing scale at each iteration step</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/preprocess.jl#L127-L156">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>sig_iqr</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="CloudClean.im_subrng" href="#CloudClean.im_subrng"><code>CloudClean.im_subrng</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">im_subrng(jx,jy,cx,cy,sx,sy,px0,py0,stepx,stepy,padx,pady,tilex,tiley) -&gt; xrng, yrng, star_ind

Computes the flux a star must have so that the PSF-based masking using `thr`
would require a larger stamp area. Used for computational savings.

# Arguments:
- `jx`: tile index along x
- `jy`: tile index along y
- `cx`: list of stellar x-coordinates
- `cy`: list of stellar y-coordinates
- `sx`: size of original image in x
- `sy`: size of original image in y
- `px0`: maximal padding in x to account for stars outside image
- `py0`: maximal padding in y to account for stars outside image
- `stepx`: tiling step size in x
- `stepy`: tiling step size in y
- `padx`: tile padding in x required to account for local stamp size, sample size, and pixels outside the image
- `pady`: tile padding in x required to account for local stamp size, sample size, and pixels outside the image
- `tilex`: total number of tile divisions along x
- `tiley`: total number of tile divisions along y

# Outputs:
- `xrng`: slicing range of the tile in x
- `yrng`: slicing range of the tile in y
- `star_ind`: Bool mask of all stars falling within the tile (subimage)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/preprocess.jl#L67-L93">source</a></section></article><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>add_sky_noise!</code>. Check Documenter&#39;s build log for details.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="CloudClean.add_noise!" href="#CloudClean.add_noise!"><code>CloudClean.add_noise!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">add_noise!(testim2,gain;seed=2021)

Adds noise to an image that matches the Poisson noise of the pixel counts.
A random seed to set a local random generator is provided for reproducible unit testing.

# Arguments:
- `testim2`: input image which had infilling
- `gain`: gain of detector to convert from photon count noise to detector noise

# Keywords:
- `seed`: random seed for random generator</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/preprocess.jl#L15-L27">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="CloudClean.kstar_circle_mask" href="#CloudClean.kstar_circle_mask"><code>CloudClean.kstar_circle_mask</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">kstar_circle_mask(Np;rlim=256) -&gt; circmask

Generates a Bool mask for pixels beyond a given (squared) radius of the center of an image.

# Arguments:
- `Np`: size of image stamp

# Keywords:
- `rlim`: squared radius (in pixels^2) beyond which pixels should be masked (default 256)

# Outputs:
- `circmask`: static Bool mask used for assigning pixels beyond some radius of the stellar center as &quot;ignored&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andrew-saydjari/CloudClean.jl/blob/79d9558e6b17c3a68f5732d3de3f205176dbcd19/src/preprocess.jl#L45-L58">source</a></section></article><h2 id="DECam-Specific-Functions"><a class="docs-heading-anchor" href="#DECam-Specific-Functions">DECam Specific Functions</a><a id="DECam-Specific-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#DECam-Specific-Functions" title="Permalink"></a></h2><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>proc_discrete</code>. Check Documenter&#39;s build log for details.</p></div></div><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>proc_continuous</code>. Check Documenter&#39;s build log for details.</p></div></div></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 31 May 2023 02:35">Wednesday 31 May 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
